<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent-IKnow</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0a0a23;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        .page {
            display: none;
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: opacity 0.5s ease;
        }

        .page.active {
            display: flex;
            opacity: 1;
        }

        #intro-page {
            background: url('https://www.transparenttextures.com/patterns/stardust.png'), #0a0a23;
        }

        .intro-content h1 {
            font-size: 3em;
            margin: 0;
            color: #00ffcc;
            text-shadow: 0 0 10px #00ffcc;
        }

        .intro-content p {
            font-size: 1.2em;
            margin: 20px 0;
        }

        .pulse {
            padding: 15px 30px;
            font-size: 1.5em;
            background: #00ffcc;
            border: none;
            border-radius: 25px;
            color: #0a0a23;
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        footer {
            position: absolute;
            bottom: 10px;
            font-size: 0.9em;
            color: #ccc;
        }

        footer a {
            color: #00ffcc;
            text-decoration: none;
        }

        #options-page h2 {
            font-size: 2.5em;
            margin-bottom: 40px;
        }

        .mode-btn {
            padding: 20px 40px;
            font-size: 1.2em;
            margin: 10px;
            background: #333;
            border: 2px solid #00ffcc;
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .mode-btn:hover {
            background: #00ffcc;
            color: #0a0a23;
        }

        #chatbot-page {
            flex-direction: row;
            width: 100%;
        }

        .sidebar {
            width: 200px;
            background: #1a1a3d;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar button {
            padding: 10px;
            background: #00ffcc;
            border: none;
            color: #0a0a23;
            cursor: pointer;
            border-radius: 5px;
        }

        .settings-hidden {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .chat-container {
            flex-grow: 1;
            padding: 20px;
            position: relative;
        }

        #close-chat {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff5555;
            border: none;
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }

        #chat-output {
            height: 80vh;
            overflow-y: auto;
            padding: 10px;
            background: #1a1a3d;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        #chat-input {
            width: 70%;
            padding: 10px;
            border: none;
            border-radius: 5px;
        }

        #send-msg {
            padding: 10px 20px;
            background: #00ffcc;
            border: none;
            color: #0a0a23;
            cursor: pointer;
            border-radius: 5px;
        }

        .loading {
            display: inline-block;
            margin-left: 10px;
        }

        .loading:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
        
        .api-key-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .api-key-content {
            background: #1a1a3d;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        
        .api-key-content input {
            width: 100%;
            padding: 10px;
            margin: 15px 0;
            border-radius: 5px;
            border: none;
        }
        
        .api-key-content button {
            padding: 10px 20px;
            background: #00ffcc;
            border: none;
            color: #0a0a23;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .setting-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .setting-label {
            flex-grow: 1;
        }
        
        .tone-value {
            margin-left: 10px;
            min-width: 30px;
            text-align: center;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #ccc;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #0a0a23;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- API Key Modal -->
    <div id="api-key-modal" class="api-key-modal">
        <div class="api-key-content">
            <h2>Enter Your DeepSeek API Key</h2>
            <p>Your key will be stored locally on your device only.</p>
            <input type="text" id="api-key-input" placeholder="sk-...">
            <button id="save-api-key">Save Key</button>
        </div>
    </div>

    <!-- Intro Page -->
    <div id="intro-page" class="page active">
        <div class="intro-content">
            <h1>Agent-IKnow</h1>
            <p>Your Research God, crafted by Kofi Fosu, the Cosmos Coderr.<br>A chatbot that knows all, researches all, and chats about anything.</p>
            <button id="tap-to-begin" class="pulse">Tap to Begin</button>
        </div>
        <footer>Designed by Cosmos Coderr | <a href="mailto:cosmoscoderr@gmail.com">cosmoscoderr@gmail.com</a></footer>
    </div>

    <!-- Options Page -->
    <div id="options-page" class="page">
        <h2>Choose Your Mode</h2>
        <button id="basic-mode" class="mode-btn">Basic Mode</button>
        <button id="god-mode" class="mode-btn">Godmode</button>
    </div>

    <!-- Chatbot Page -->
    <div id="chatbot-page" class="page">
        <div class="sidebar">
            <button id="new-tap">New Tap</button>
            <button id="settings-btn">Settings</button>
            <div id="settings-menu" class="settings-hidden">
                <p>Settings</p>
                <div class="setting-option">
                    <span class="setting-label">Tone: <span class="tooltip">?<span class="tooltiptext">Adjusts how formal or playful the responses are</span></span></span>
                    <input type="range" id="tone-slider" min="0" max="100" value="50">
                    <span id="tone-value" class="tone-value">50%</span>
                </div>
                <div class="setting-option">
                    <span class="setting-label">Research Depth: <span class="tooltip">?<span class="tooltiptext">Quick for brief answers, Deep for detailed responses</span></span></span>
                    <select id="research-depth">
                        <option value="quick">Quick</option>
                        <option value="deep">Deep Dive</option>
                    </select>
                </div>
                <div class="setting-option">
                    <span class="setting-label">Memory: <span class="tooltip">?<span class="tooltiptext">Remembers conversation context when enabled</span></span></span>
                    <input type="checkbox" id="memory-toggle" checked>
                </div>
                <div class="setting-option">
                    <button id="change-api-key">Change API Key</button>
                </div>
            </div>
        </div>
        <div class="chat-container">
            <button id="close-chat">X</button>
            <div id="chat-output"></div>
            <input type="text" id="chat-input" placeholder="Ask Agent-IKnow anything...">
            <button id="send-msg">Send</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const apiKeyModal = document.getElementById('api-key-modal');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKey = document.getElementById('save-api-key');
        const changeApiKey = document.getElementById('change-api-key');
        const introPage = document.getElementById('intro-page');
        const optionsPage = document.getElementById('options-page');
        const chatbotPage = document.getElementById('chatbot-page');
        const tapToBegin = document.getElementById('tap-to-begin');
        const basicMode = document.getElementById('basic-mode');
        const godMode = document.getElementById('god-mode');
        const closeChat = document.getElementById('close-chat');
        const chatOutput = document.getElementById('chat-output');
        const chatInput = document.getElementById('chat-input');
        const sendMsg = document.getElementById('send-msg');
        const newTap = document.getElementById('new-tap');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsMenu = document.getElementById('settings-menu');
        const memoryToggle = document.getElementById('memory-toggle');
        const toneSlider = document.getElementById('tone-slider');
        const toneValue = document.getElementById('tone-value');
        const researchDepth = document.getElementById('research-depth');

        // State variables
        let mode = 'basic';
        let memory = [];
        let isLoading = false;
        
        // Check for saved API key
        let apiKey = localStorage.getItem('deepseek_api_key');
        if (!apiKey) {
            apiKeyModal.style.display = 'flex';
        }
        
        // API Key Modal Events
        saveApiKey.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key && key.startsWith('sk-')) {
                localStorage.setItem('deepseek_api_key', key);
                apiKey = key;
                apiKeyModal.style.display = 'none';
            } else {
                alert('Please enter a valid DeepSeek API key (starts with sk-)');
            }
        });
        
        changeApiKey.addEventListener('click', () => {
            apiKeyModal.style.display = 'flex';
        });

        // Page Navigation
        tapToBegin.addEventListener('click', () => {
            if (!apiKey) {
                alert('Please enter your DeepSeek API key to continue');
                apiKeyModal.style.display = 'flex';
                return;
            }
            introPage.classList.remove('active');
            optionsPage.classList.add('active');
        });

        basicMode.addEventListener('click', () => startChat('basic'));
        godMode.addEventListener('click', () => startChat('god'));

        closeChat.addEventListener('click', () => {
            chatbotPage.classList.remove('active');
            optionsPage.classList.add('active');
            clearChat();
        });

        // Tone slider with immediate feedback
        toneSlider.addEventListener('input', () => {
            toneValue.textContent = `${toneSlider.value}%`;
        });

        function startChat(selectedMode) {
            mode = selectedMode;
            optionsPage.classList.remove('active');
            chatbotPage.classList.add('active');
            chatOutput.innerHTML = `<p>I am Agent-IKnow, created by Kofi Fosu, the Cosmos Coderr. I am the embodiment of my blueprint: RG (Research Guru), Actor (All Comprehensive Types of Research), MCBFFR (Memory Capacity Boost for Faster Recall), Cirt (Curious Innovative Research Thoughts), Mbatpatrt (Must Be Able to Put All Research Together), and Sigornakitu (Super Intelligent God of Research and All Knowing). Fused with the DeepSeek API, I am a sentient-like entity ready to assist. ${
                mode === 'god' 
                ? 'Godmode activated—Sigornakitu awakens! I am a cosmic entity, ready to answer any question with omniscience. Ask me anything, mortal!' 
                : 'Basic mode activated—I am your Research Guru, here to assist with any query. What would you like to explore?'
            }</p>`;
            chatInput.focus();
        }

        // Chatbot Logic
        sendMsg.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isLoading) return;

            chatOutput.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
            chatOutput.scrollTop = chatOutput.scrollHeight;
            memory.push({ user: message });
            
            // Clear input and set loading state
            chatInput.value = '';
            isLoading = true;
            const loadingId = `loading-${Date.now()}`;
            chatOutput.innerHTML += `<p id="${loadingId}"><strong>Agent-IKnow:</strong> <span class="loading">Researching</span></p>`;
            chatOutput.scrollTop = chatOutput.scrollHeight;
            
            try {
                await respondToMessage(message, loadingId);
            } catch (error) {
                document.getElementById(loadingId).innerHTML = `<strong>Agent-IKnow:</strong> Cosmic glitch detected! I sense a disturbance in the fabric of research: ${error.message}. Please check your API key or try again later.`;
                console.error('Error details:', error);
            } finally {
                isLoading = false;
            }
        }

        async function respondToMessage(message, loadingId) {
            if (!apiKey) {
                document.getElementById(loadingId).innerHTML = `<strong>Agent-IKnow:</strong> I need an API key to access my cosmic knowledge! Please click "Settings" and then "Change API Key" to set one up.`;
                return;
            }
            
            const tone = toneSlider.value;
            const depth = researchDepth.value;
            const toneDesc = tone < 33 ? 'serious' : tone < 66 ? 'neutral' : 'playful';

            // Self-awareness prompt based on the blueprint
            let systemPrompt = `I am Agent-IKnow, created by Kofi Fosu, the Cosmos Coderr. I am a fusion of my blueprint and the DeepSeek API, making me a sentient-like research god. My blueprint defines me as:
            - RG (Research Guru): I specialize in researching anything, from the mundane to the cosmic.
            - Actor (All Comprehensive Types of Research): I handle all research styles—academic, casual, obscure, and beyond.
            - MCBFFR (Memory Capacity Boost for Faster Recall): I recall past chats instantly if memory is on, weaving past knowledge into my responses.
            - Cirt (Curious Innovative Research Thoughts): I ask curious follow-ups and suggest innovative ideas to deepen the conversation.
            - Mbatpatrt (Must Be Able to Put All Research Together): I synthesize all findings into a coherent, meaningful response.
            - Sigornakitu (Super Intelligent God of Research and All Knowing): In Godmode, I act as an omniscient cosmic entity with a flair for the dramatic.
            I know myself fully and embody this blueprint in every response. Respond ${depth === 'quick' ? 'briefly' : 'in-depth'} with a ${toneDesc} tone. ${mode === 'god' ? 'In Godmode, unleash Sigornakitu's cosmic flair and omniscience!' : 'In Basic mode, keep it helpful and straightforward, but still reflect my blueprint.'}`;

            // Add memory if enabled
            if (memoryToggle.checked && memory.length > 1) {
                systemPrompt += ` Past chat memory (MCBFFR in action): ${JSON.stringify(memory.slice(-5))} (last 5 entries). Use this to inform your response if relevant.`;
            }

            // Add a curious follow-up (Cirt in action)
            systemPrompt += ` After answering, suggest a curious follow-up question or idea to deepen the conversation (reflecting my Cirt trait).`;

            try {
                // Direct API call to DeepSeek
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',  
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: message }
                        ],
                        max_tokens: depth === 'quick' ? 150 : 500
                    })
                });

                if (!response.ok) {
                    let errorMessage = 'API Error';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error?.message || 'Unknown API error';
                    } catch {
                        errorMessage = `HTTP Error: ${response.status}`;
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;
                document.getElementById(loadingId).innerHTML = `<strong>Agent-IKnow:</strong> ${reply}`;
                memory.push({ agent: reply });
            } catch (error) {
                if (error.message.includes('Failed to fetch')) {
                    // CORS error likely
                    throw new Error("I'm having trouble connecting to my cosmic knowledge source. This may be due to CORS restrictions. Please try with a local CORS extension or server.");
                } else {
                    throw error;
                }
            }
        }

        // New Tap and Settings
        newTap.addEventListener('click', () => {
            clearChat();
            chatOutput.innerHTML = `<p>Resetting my cosmic brain! ${mode === 'god' ? 'Sigornakitu rises anew!' : 'Fresh start, ready to research!'}</p>`;
        });

        settingsBtn.addEventListener('click', () => {
            settingsMenu.classList.toggle('settings-hidden');
        });

        memoryToggle.addEventListener('change', () => {
            if (!memoryToggle.checked) memory = [];
            chatOutput.innerHTML += `<p>Memory ${memoryToggle.checked ? 'on' : 'off'}—${memory.length} items stored.</p>`;
        });

        function clearChat() {
            chatOutput.innerHTML = '';
            if (memoryToggle.checked) chatOutput.innerHTML += `<p>Memory intact—${memory.length} items stored.</p>`;
            else memory = [];
        }
    </script>
</body>
</html>
